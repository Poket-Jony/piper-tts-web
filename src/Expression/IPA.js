import MouthExpression from './MouthExpression';

/**
 * @see VRM Model Reference: https://vrm-viewer-48655.web.app/
 * @see IPA Reference: https://www.seeingspeech.ac.uk/ipa-charts/
 */
export default class {
  #pauseDuration = 270;
  #wordBreakDuration = 12;
  #characterDuration = 40.05;
  #ipaMouth = {
    ' ': new MouthExpression({ duration: this.#wordBreakDuration }),
    '.': new MouthExpression({ duration: this.#pauseDuration }),
    ',': new MouthExpression({ duration: this.#pauseDuration }),
    i: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.22,
      ee: 0,
      ih: 1,
      oh: 0,
      ou: 0,
    }),
    y: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.25,
      ou: 1,
    }),
    ɨ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 41,
      ih: 1,
      oh: 0,
      ou: 0,
    }),
    ʉ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.16,
      ou: 1,
    }),
    ɯ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.09,
      ih: 0,
      oh: 0.07,
      ou: 0.03,
    }),
    u: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.27,
      ou: 1,
    }),
    ɪ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 1,
      ih: 0,
      oh: 0,
      ou: 0,
    }),
    ʊ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.28,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.44,
    }),
    e: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 1,
      ih: 57,
      oh: 0,
      ou: 0,
    }),
    ø: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 1,
      ih: 0,
      oh: 0.15,
      ou: 0.21,
    }),
    ɤ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.5,
      ih: 0,
      oh: 0,
      ou: 0,
    }),
    o: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 1,
      ou: 0,
    }),
    ə: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.51,
      ee: 0.23,
      ih: 0.34,
      oh: 0,
      ou: 0.11,
    }),
    ɛ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.65,
      ee: 0.24,
      ih: 0.82,
      oh: 0,
      ou: 0,
    }),
    œ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.43,
      ee: 0.22,
      ih: 0,
      oh: 0.53,
      ou: 0,
    }),
    ʌ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.79,
      ee: 0,
      ih: 0,
      oh: 0.27,
      ou: 0,
    }),
    ɔ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0.41,
      oh: 1,
      ou: 0,
    }),
    ɐ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.53,
      ee: 0.4,
      ih: 0.61,
      oh: 0,
      ou: 0,
    }),
    æ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.57,
      ee: 0.45,
      ih: 0.31,
      oh: 0,
      ou: 0,
    }),
    a: new MouthExpression({
      duration: this.#characterDuration,
      aa: 1,
      ee: 0,
      ih: 0,
      oh: 0.26,
      ou: 0,
    }),
    ɶ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.5,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.18,
    }),
    ɑ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.63,
      ih: 0,
      oh: 0,
      ou: 0,
    }),
    ɒ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.38,
      ee: 0,
      ih: 0,
      oh: 0.56,
      ou: 0.27,
    }),
    p: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0,
    }),
    b: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0,
    }),
    t: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.33,
    }),
    d: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.33,
    }),
    ʈ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.28,
      ee: 0,
      ih: 0,
      oh: 0.24,
      ou: 0.27,
    }),
    ɖ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.28,
      ee: 0,
      ih: 0,
      oh: 0.24,
      ou: 0.27,
    }),
    c: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.28,
      ee: 0,
      ih: 0.23,
      oh: 0.13,
      ou: 0.18,
    }),
    ɟ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.13,
      ee: 0,
      ih: 0.15,
      oh: 0.07,
      ou: 0.12,
    }),
    k: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.37,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.29,
    }),
    ɡ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.08,
      ee: 0,
      ih: 0,
      oh: 0.19,
      ou: 0,
    }),
    q: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.08,
      ee: 0,
      ih: 0,
      oh: 0.19,
      ou: 0,
    }),
    ɢ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.08,
      ee: 0,
      ih: 0,
      oh: 0.19,
      ou: 0,
    }),
    ʔ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.15,
      ee: 0,
      ih: 0,
      oh: 0.15,
      ou: 0,
    }),
    m: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0,
    }),
    ɱ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.03,
      ou: 0.08,
    }),
    n: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.03,
      ou: 0.41,
    }),
    ɳ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.03,
      ou: 0.88,
    }),
    ɲ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.02,
      ou: 0.74,
    }),
    ŋ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.53,
    }),
    ɴ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.38,
    }),
    ʙ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.15,
      ou: 0.52,
    }),
    r: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.38,
    }),
    ʀ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.16,
      ee: 0,
      ih: 0,
      oh: 0.06,
      ou: 0.71,
    }),
    ⱱ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.16,
      ee: 0.05,
      ih: 0.06,
      oh: 0,
      ou: 0,
    }),
    ɾ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.05,
      ee: 0,
      ih: 0.14,
      oh: 0.11,
      ou: 0.14,
    }),
    ɽ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.09,
      ee: 0,
      ih: 0,
      oh: 0.09,
      ou: 0.44,
    }),
    ɸ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.45,
    }),
    β: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.34,
    }),
    f: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.05,
      ou: 0.35,
    }),
    v: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.31,
    }),
    θ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.07,
      ih: 0.27,
      oh: 0,
      ou: 0.47,
    }),
    ð: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.03,
      ee: 0,
      ih: 0.19,
      oh: 0,
      ou: 0.3,
    }),
    s: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0.85,
      oh: 0,
      ou: 0.12,
    }),
    z: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0.46,
      oh: 0,
      ou: 0.3,
    }),
    ʃ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.16,
      ih: 0.4,
      oh: 0,
      ou: 0.51,
    }),
    ʒ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.05,
      ee: 0.08,
      ih: 0.39,
      oh: 0,
      ou: 0.42,
    }),
    ʂ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0.49,
      oh: 0.1,
      ou: 0.05,
    }),
    ʐ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 1,
      oh: 0.05,
      ou: 0.17,
    }),
    ç: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.16,
      ih: 1,
      oh: 0,
      ou: 0.18,
    }),
    ʝ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.17,
      ih: 1,
      oh: 0,
      ou: 0.28,
    }),
    x: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.23,
      ee: 0,
      ih: 0.21,
      oh: 0,
      ou: 0,
    }),
    ɣ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.11,
      ee: 0,
      ih: 0.2,
      oh: 0,
      ou: 0.15,
    }),
    χ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.2,
      ih: 0,
      oh: 0.18,
      ou: 0.46,
    }),
    ʁ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0.55,
      oh: 0,
      ou: 0.4,
    }),
    ħ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.07,
      ee: 0,
      ih: 0,
      oh: 0.16,
      ou: 0.32,
    }),
    ʕ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0.16,
      oh: 0,
      ou: 0.44,
    }),
    h: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.26,
      ee: 0,
      ih: 0,
      oh: 0.17,
      ou: 0,
    }),
    ɦ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.28,
      ou: 0,
    }),
    ɬ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.19,
      ih: 0.42,
      oh: 0,
      ou: 0.3,
    }),
    ɮ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.19,
      ih: 0.3,
      oh: 0,
      ou: 0.26,
    }),
    ʋ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0,
      ou: 0.14,
    }),
    ɹ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.08,
      ih: 0,
      oh: 0.1,
      ou: 0.09,
    }),
    ɻ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.22,
      ou: 0.22,
    }),
    j: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.11,
      ee: 0,
      ih: 0.94,
      oh: 0,
      ou: 0,
    }),
    ɰ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.15,
      ih: 0.21,
      oh: 0,
      ou: 0,
    }),
    l: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.01,
      ee: 0.22,
      ih: 0.08,
      oh: 0,
      ou: 0,
    }),
    ɭ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.1,
      ee: 0.34,
      ih: 0.24,
      oh: 0,
      ou: 0,
    }),
    ʎ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.02,
      ee: 0.24,
      ih: 0.22,
      oh: 0,
      ou: 0,
    }),
    ʟ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.25,
      ih: 0.0,
      oh: 0,
      ou: 0,
    }),
    ʘ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.0,
      ih: 0.0,
      oh: 0,
      ou: 0.14,
    }),
    ɓ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.0,
      ih: 0.0,
      oh: 0,
      ou: 0,
    }),
    ǀ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.0,
      ih: 0.0,
      oh: 0,
      ou: 0.27,
    }),
    ɗ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.09,
      ih: 0.1,
      oh: 0,
      ou: 0.28,
    }),
    ǃ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.0,
      ih: 0.04,
      oh: 0.09,
      ou: 0.06,
    }),
    ʄ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.0,
      ih: 0.42,
      oh: 0,
      ou: 0.35,
    }),
    ǂ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.0,
      ih: 0.57,
      oh: 0.15,
      ou: 0.07,
    }),
    ɠ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0.09,
      ee: 0.0,
      ih: 0.0,
      oh: 0.11,
      ou: 0,
    }),
    ǁ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.0,
      ih: 0.0,
      oh: 0.15,
      ou: 0.19,
    }),
    ʛ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.13,
      ih: 0.0,
      oh: 0.15,
      ou: 0.03,
    }),
    ʍ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.0,
      ih: 0.0,
      oh: 0.25,
      ou: 0.34,
    }),
    ʑ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.3,
      ih: 0.22,
      oh: 0.0,
      ou: 0.0,
    }),
    ɕ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.31,
      ih: 0.34,
      oh: 0.0,
      ou: 0.0,
    }),
    w: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.0,
      ih: 0.0,
      oh: 0.0,
      ou: 1,
    }),
    ɺ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0.08,
      ih: 0.18,
      oh: 0.0,
      ou: 0.19,
    }),
    ɥ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.22,
      ou: 0.86,
    }),
    ɧ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.22,
      ou: 0.27,
    }),
    ʜ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.16,
      ou: 0.23,
    }),
    ʢ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.16,
      ou: 0.17,
    }),
    ʡ: new MouthExpression({
      duration: this.#characterDuration,
      aa: 0,
      ee: 0,
      ih: 0,
      oh: 0.13,
      ou: 0.16,
    }),
  };
  #ipa = null;

  get ipa() {
    return this.#ipa;
  }

  constructor(phonemes) {
    this.#ipa = this.#normalize(phonemes.join(' '));
  }

  generateMouthExpressions(duration) {
    const mouthExpressions = [];
    let calculatedDuration = 0;
    for (let i = 0; i < this.#ipa.length; i++) {
      const char = this.#ipa.charAt(i);
      if (this.#ipaMouth[char]) {
        const expression = Object.assign({}, this.#ipaMouth[char]);
        mouthExpressions.push(expression);
        calculatedDuration += expression.duration;
      }
    }
    duration = duration || calculatedDuration;
    const durationCorrectionMultiplier = duration / calculatedDuration;
    for (let i = 0; i < mouthExpressions.length; i++) {
      mouthExpressions[i].duration = mouthExpressions[i].duration * durationCorrectionMultiplier;
    }
    return mouthExpressions;
  }

  #normalize(ipa) {
    let normedIpa = ipa.replaceAll(' _ ', '');
    if (normedIpa.startsWith('^')) {
      normedIpa = normedIpa.slice(1);
    }
    if (normedIpa.endsWith('$')) {
      normedIpa = normedIpa.slice(0, -1);
    }
    return normedIpa;
  }
}
